<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/cli.js | comptroller</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="A simple and lightweight tool to manage your monorepo."><meta property="twitter:card" content="summary"><meta property="twitter:title" content="comptroller"><meta property="twitter:description" content="A simple and lightweight tool to manage your monorepo."></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/Aldlevine/comptroller"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/comptroller.js~Comptroller.html">Comptroller</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/package.js~Package.html">Package</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/patch.js~Patch.html">Patch</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/cli.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">#!/usr/bin/env node

const {
  version
} = require(&apos;../package.json&apos;);
const path = require(&apos;./path&apos;);
const minimist = require(&apos;minimist&apos;);
const dedent = require(&apos;dedent&apos;);
const fs = require(&apos;./fs&apos;);
const logger = require(&apos;./logger&apos;);
const Comptroller = require(&apos;./comptroller&apos;);

/**
 * The cli arguments
 * @type {object}
 */
const argv = minimist(process.argv.slice(2));

/**
 * The command to run
 * @type {string}
 */
const command = argv._[0] || &apos;help&apos;;

/**
 * The package root dir
 * @type {string}
 */
const root = argv._[1] || &apos;.&apos;;

/**
 * Whether or not Comtroller should prune dependencies.
 * @type {boolean}
 */
const prune = argv.prune || argv.p;

const logOn = argv.log || argv.logging || argv.logOn || argv.logon;
const amd = argv.amd
let commonjs = argv.commonjs || argv.cjs;
const typescript = argv.typescript || argv.ts;
const es6 = argv.es6 || argv.mjs;

// by default set commonjs to true
if (commonjs === undefined) {
  commonjs = true
}

/**
 * Whether or not Comptroller should update the root package.
 * @type {boolean}
 */
const self = argv.self || argv.s;

/**
 * A function map for all cli commands
 * @type {Map&lt;string, function&gt;}
 */
const cli = {
  /**
   * Prints the help message
   */
  help() {
    logger.log(dedent `
      Comptroller ${version}

      Usage:
      --------
      comp &lt;command&gt; [options]

      Commands:
      --------
      help                      Show this message
      update [root-directory]   Update all subpackages of package found at [root-directory]
      link [root-directory]     Create symlink in node_modules for each subpackage found at [root-directory]
      version                   Print Comptroller version

      Options:
      --------
      --prune -p                Remove unused dependencies from subpackges&apos; package.json
      --self -s                 If set, only the root package will be updated
      --log                     Turn on logging (when resolving dependencies)
      --commonjs --cjs          CommonJS (ie. node.js require) module dependencies
      --typescript --ts         TypeScript (ie. import/export) module dependencies
      --es6 --mjs               ES6 (ie. import/export) module dependencies
  `);
  },

  /**
   * Updates all subpackages of package found at [root-directory]
   */
  async update() {
    const comp = new Comptroller({
      root,
      prune,
      logOn,
      commonjs,
      amd,
      typescript,
      es6
    });

    if (self) {
      await comp.updateSelf();
      await comp.writePackageJson();
    } else {
      await comp.updatePackages();
      await comp.writePackages();
    }
  },

  /**
   * Creates symlink in node_modules for each subpackage found at [root-directory]
   */
  async link() {
    const comp = new Comptroller({
      root,
      prune
    });
    await comp.linkPackages();
  },

  /**
   * Prints Comptroller version
   */
  version() {
    logger.log(`Comptroller ${version}`);
  },
}

;
(async function main() {
  try {
    await cli[command]();
  } catch (err) {
    if (err instanceof Error) {
      return logger.error(err.stack);
    }
    logger.error(err);
  }
})();
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.0.3)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
